{"version":3,"file":"Follow.js","sourceRoot":"","sources":["../../src/plugins/Follow.ts"],"names":[],"mappings":"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","sourcesContent":["import { Plugin } from './Plugin';\n\nimport type { DisplayObject } from '@pixi/display';\nimport type { IPointData } from '@pixi/core';\nimport type { Viewport } from '../Viewport';\n\n/** Options for {@link Follow}. */\nexport interface IFollowOptions\n{\n    /**\n     * Speed to follow in px/frame (0 = teleport to location)\n     *\n     * @default 9\n     */\n    speed?: number;\n\n    /**\n     * Set acceleration to accelerate and decelerate at this rate; speed cannot be 0 to use acceleration\n     *\n     * @default null\n     */\n    acceleration?: number | null;\n\n    /**\n     * Radius (in world coordinates) of center circle where movement is allowed without moving the viewport\n     *\n     * @default null\n     */\n    radius?: number | null;\n}\n\nconst DEFAULT_FOLLOW_OPTIONS: Required<IFollowOptions> = {\n    speed: 0,\n    acceleration: null,\n    radius: null\n};\n\n/**\n * Plugin to follow a display-object.\n *\n * @see Viewport.follow\n * @public\n */\nexport class Follow extends Plugin\n{\n    /** The options used to initialize this plugin. */\n    public readonly options: Required<IFollowOptions>;\n\n    /** The target this plugin will make the viewport follow. */\n    public target: DisplayObject;\n\n    /** The velocity provided the viewport by following, at the current time. */\n    protected velocity: IPointData;\n\n    /**\n     * This is called by {@link Viewport.follow}.\n     *\n     * @param parent\n     * @param target - target to follow\n     * @param options\n     */\n    constructor(parent: Viewport, target: DisplayObject, options: IFollowOptions = {})\n    {\n        super(parent);\n\n        this.target = target;\n        this.options = Object.assign({}, DEFAULT_FOLLOW_OPTIONS, options);\n        this.velocity = { x: 0, y: 0 };\n    }\n\n    public update(elapsed: number): void\n    {\n        if (this.paused)\n        {\n            return;\n        }\n\n        const center = this.parent.center;\n        let toX = this.target.x;\n        let toY = this.target.y;\n\n        if (this.options.radius)\n        {\n            const distance = Math.sqrt(Math.pow(this.target.y - center.y, 2) + Math.pow(this.target.x - center.x, 2));\n\n            if (distance > this.options.radius)\n            {\n                const angle = Math.atan2(this.target.y - center.y, this.target.x - center.x);\n\n                toX = this.target.x - (Math.cos(angle) * this.options.radius);\n                toY = this.target.y - (Math.sin(angle) * this.options.radius);\n            }\n            else\n            {\n                return;\n            }\n        }\n\n        const deltaX = toX - center.x;\n        const deltaY = toY - center.y;\n\n        if (deltaX || deltaY)\n        {\n            if (this.options.speed)\n            {\n                if (this.options.acceleration)\n                {\n                    const angle = Math.atan2(toY - center.y, toX - center.x);\n                    const distance = Math.sqrt(Math.pow(deltaX, 2) + Math.pow(deltaY, 2));\n\n                    if (distance)\n                    {\n                        const decelerationDistance = (Math.pow(this.velocity.x, 2) + Math.pow(this.velocity.y, 2))\n                            / (2 * this.options.acceleration);\n\n                        if (distance > decelerationDistance)\n                        {\n                            this.velocity = {\n                                x: Math.min(this.velocity.x + (this.options.acceleration * elapsed, this.options.speed)),\n                                y: Math.min(this.velocity.y + (this.options.acceleration * elapsed, this.options.speed))\n                            };\n                        }\n                        else\n                        {\n                            this.velocity = {\n                                x: Math.max(this.velocity.x - (this.options.acceleration * this.options.speed), 0),\n                                y: Math.max(this.velocity.y - (this.options.acceleration * this.options.speed), 0)\n                            };\n                        }\n                        const changeX = Math.cos(angle) * this.velocity.x;\n                        const changeY = Math.sin(angle) * this.velocity.y;\n                        const x = Math.abs(changeX) > Math.abs(deltaX) ? toX : center.x + changeX;\n                        const y = Math.abs(changeY) > Math.abs(deltaY) ? toY : center.y + changeY;\n\n                        this.parent.moveCenter(x, y);\n                        this.parent.emit('moved', { viewport: this.parent, type: 'follow' });\n                    }\n                }\n                else\n                {\n                    const angle = Math.atan2(toY - center.y, toX - center.x);\n                    const changeX = Math.cos(angle) * this.options.speed;\n                    const changeY = Math.sin(angle) * this.options.speed;\n                    const x = Math.abs(changeX) > Math.abs(deltaX) ? toX : center.x + changeX;\n                    const y = Math.abs(changeY) > Math.abs(deltaY) ? toY : center.y + changeY;\n\n                    this.parent.moveCenter(x, y);\n                    this.parent.emit('moved', { viewport: this.parent, type: 'follow' });\n                }\n            }\n            else\n            {\n                this.parent.moveCenter(toX, toY);\n                this.parent.emit('moved', { viewport: this.parent, type: 'follow' });\n            }\n        }\n    }\n}\n"]}